<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python For Kids</title>
    <script src="./js/pyodide/pyodide.min.js"></script>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link rel="stylesheet" href="./js/constrained-editor-plugin/dist/constrainedEditorPlugin.css">
    <script src="./js/constrained-editor-plugin/dist/constrainedEditorPlugin.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sketch {
            border-top-left-radius: 255px 15px;
            border-top-right-radius: 15px 225px;
            border-bottom-right-radius: 225px 15px;
            border-bottom-left-radius: 15px 255px;
        }
    </style>
</head>

<body class="relative p-0 m-0 w-full overflow-hidden">
    <div class="w-full h-screen flex flex-col">
        <div class="w-full h-[50%] border-black border-4 sketch p-4">

        </div>
        <div class="w-full h-[50%] grid grid-cols-2 gap-0">
            <div class="bg-transparent border-black border-4 sketch w-full h-full p-4">
                <button id="run-button" class="p-2">Run Code</button>
                <div id="editor" class="h-full"></div>
            </div>
            <div class="bg-transparent w-full h-full border-black border-4 sketch p-4">
                <button id="submit-button" class="p-2">Submit Code</button>
                <div id="output" class="w-full h-full"></div>
            </div>
        </div>
    </div>

    <py-script>
        from js import console
        from pyodide.ffi import create_proxy

        def runPython(event):
            value = document.editor.getValue()
            eval(value + "\n" + "print(addKeysToUtils())")
            document.getElementById("output").innerHTML = "Hello"

        def submitPython(event):
            return

        function_proxy = create_proxy(runPython)
        document.getElementById("submit-button").addEventListener("click", function_proxy)
    </py-script>

    <script src="./js/monaco/loader.min.js"></script>

    <script>
        // Proxy Monaco Editor workers using a data URL (adapted from: https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-amd-cross.md)
        require.config({ paths: { "vs": "./js/monaco/min/vs/" } });

        window.MonacoEnvironment = {
            getWorkerUrl: function (workerId, label) {
                return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
                    self.MonacoEnvironment = { baseUrl: "https://daovietanh99.github.io/PythonCompetition/js/monaco/min/" };
                    importScripts("https://daovietanh99.github.io/PythonCompetition/js/monaco/worker.min.js");`
                )}`;
            }
        };

        require(['vs/editor/editor.main'], function () {
            const container = document.getElementById('editor')
            const editorInstance = monaco.editor.create(container, {
                value: [
                    'def addKeysToUtils():',
                    '  #add your code here',
                    '  return',
                ].join('\n'),
                language: 'python'
            });
            const model = editorInstance.getModel();
            document.editor = editorInstance

            const editorElement = document.getElementById("editor");
            window.addEventListener("resize", () => editorInstance.layout({
                width: editorElement.offsetWidth,
                height: editorElement.offsetHeight
            }));

            // - Configuration for the Constrained Editor : Starts Here
            const constrainedInstance = constrainedEditor(monaco);
            constrainedInstance.initializeIn(editorInstance);
            constrainedInstance.addRestrictionsTo(model, [{
                range: [2, 3, 2, 22], // Range of Function definition
                allowMultiline: true,
                label: 'funcDefinition'
            }]);
            // - Configuration for the Constrained Editor : Ends Here
        });

        function save() {
            // get the value of the data
            var value = window.editor.getValue()
            saveValueSomewhere(value);
        }
    </script>

</body>

</html>
